<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="msvalidate.01" content="F7959A0570D0607B4121B537616DDEAB"><meta name="renderer" content="webkit"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="keywords" content="Get Bing Wallpaper, Bing, Wallpaper, Windows, C/C++"><meta name="description" content="Get Bing Wallpaper. It&#39;s a program written by C++, it will automatically download and set wallpaper for you!"><title>Windows, C++ | Bing Backgrounds GetterTheodore Cooper's Blog</title><script src="/sweetalert2/dist/sweetalert2.all.min.js"></script><script src="/promise-polyfill/dist/polyfill.js"></script><link rel="stylesheet" href="/sweetalert2/dist/sweetalert2.min.css"><link href="/css/fontisto/fontisto.min.css" rel="stylesheet"><link rel="stylesheet" href="/libs/highlight/styles/androidstudio.css"><link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="/css/style.css"><link href="http://fonts.googleapis.com/css?family=Raleway:100,200,300,400" rel="stylesheet"><script src="/dist/lib/modernizr.touch.js"></script><link href="/dist/mfb.css" rel="stylesheet"><script async src="https://www.googletagmanager.com/gtag/js?id=G-DZQ9LW0MKP"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-DZQ9LW0MKP")</script><script>!function(t,e,n,c,a,r){t[n]=t[n]||function(){(t[n].q=t[n].q||[]).push(arguments)},(a=e.createElement(c)).async=1,a.src="https://www.clarity.ms/tag/4dyudg5g3l",(r=e.getElementsByTagName(c)[0]).parentNode.insertBefore(a,r)}(window,document,"clarity","script")</script><meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="Theodore Cooper's Blog" type="application/atom+xml"></head><body id="bodyx"><ul id="menu" class="mfb-component--br mfb-slidein-spring" data-mfb-toggle="click"><li class="mfb-component__wrap"><a class="mfb-component__button--main"><i class="mfb-component__main-icon--resting fi fi-plus-a"></i> <i class="mfb-component__main-icon--active fi fi-close-a"></i></a><ul class="mfb-component__list"><li><a href="https://theodorecooper.github.io/atom.xml" data-mfb-label="RSS" class="mfb-component__button--child" target="_blank"><i class="mfb-component__child-icon fi fi-rss"></i></a></li><li><a href="https://theodorecooper.github.io/tags" data-mfb-label="View the tags" class="mfb-component__button--child" target="_blank"><i class="mfb-component__child-icon fi fi-hashtag"></i></a></li><li><a href="https://theodorecooper.github.io/Github" data-mfb-label="Follow me on Github" class="mfb-component__button--child" target="_blank"><i class="mfb-component__child-icon fi fi-github"></i></a></li><li><a href="https://theodorecooper.github.io/Twitter" data-mfb-label="Follow me on Twitter" class="mfb-component__button--child" target="_blank"><i class="mfb-component__child-icon fi fi-twitter"></i></a></li><li><a href="javascrip:void(0)" onclick="donate()" data-mfb-label="Buy me a cup of coffee!" class="mfb-component__button--child" target="_self"><i class="mfb-component__child-icon fi fi-bitcoin"></i></a></li></ul></li></ul><script src="/dist/mfb.js"></script><script>var donate=function(){Swal.fire({title:"Donate",html:"Buy me a cup of coffee!!! <br><br>zpub6maNAHkLN2gfztxLDnKVjJASMk1Ra5DgdF2yGSTov7VXUn3Eijusyye89aKSwZWxrRas4QJnVtwXKEzdpKhTMSgiXF9RuK6AMm6w3V4jnMr",imageUrl:"/btcqrcode.png",imageWidth:205,imageHeight:205,imageAlt:"Bitcoin Donate",animation:!0,footer:"<b>Thank you for donation!!!</b>"})}</script><div class="hd posts"><a href="/index.html"><i class="fa fa-reply replay-btn" aria-hidden="true"></i></a><div class="post-title"><p>Windows, C++ | Bing Backgrounds Getter</p><hr></div><div class="post-content"><h1><span id="windows-c-bing-backgrounds-getter"><center>Windows, C++ | Bing Backgrounds Getter</center></span></h1><h2><span id="wallpapers-bing">Wallpapers, Bing…</span></h2><p>​ Have you ever tried to download wallpapers from <a target="_blank" rel="noopener" href="http://www.bing.com/">www.bing.com</a>? Have you ever dreamed of a fantastic background but feel bored with download wallpapers by hands! It’s a program written by C++, it will automatically download and set wallpaper for you!</p><img src="BBG.jpg" alt="My program" style="zoom:25%"><h2><span id="how-does-it-works">How does it works</span></h2><p>​ It will download a XML file contains the API of <a target="_blank" rel="noopener" href="http://www.bing.com/">www.bing.com</a>, and then, I use <em>tinyxml</em> to parse the file to obtain the full URL-path of the daily wallpaper. Finally, the wallpaper will be download and set as the background.</p><h2><span id="details">Details</span></h2><p>Platform:</p><ul><li>Windows 7</li><li>Visual Studio 2019(Preview)</li><li>Old damn computer &amp; sh*t mouse &amp; dusty keyboard</li></ul><hr><p>​ What’s the local of the wallpaper? After Googling, I get this: <strong><em>“<a target="_blank" rel="noopener" href="https://www.bing.com/HPImageArchive.aspx?format=xml&amp;idx=0&amp;n=1&amp;mkt=en-US&quot;">https://www.bing.com/HPImageArchive.aspx?format=xml&amp;idx=0&amp;n=1&amp;mkt=en-US&quot;</a></em></strong>. That’s important, the full URL is contained in this file. Take a look at the label <code>&lt;image&gt;&lt;url&gt;&lt;/url&gt;&lt;/image&gt;</code>, it’s the part of the full path, just cat <code>&quot;www.bing.com&quot;</code> with it, you will obtain the full path.</p><p>​ So, we should download the XML and try to parse it. We require <code>URLDownloadToFile()</code> to download remote files:</p><pre><code class="c">string xml_url = &quot;https://cn.bing.com/HPImageArchive.aspx?format=xml&amp;idx=0&amp;n=1&quot;;
size_t len = xml_url.length();
int nmlen = MultiByteToWideChar(CP_ACP, 0, xml_url.c_str(), len + 1, NULL, 0);
wchar_t* buffer = new wchar_t[nmlen];
MultiByteToWideChar(CP_ACP, 0, xml_url.c_str(), len + 1, buffer, nmlen);
HRESULT hr = URLDownloadToFile(NULL, buffer, _T(&quot;C:\\Program Files\\The0d0re C00per\\Bing Backgrouds\\XML\\INDEX.xml&quot;), 0, NULL);
if (hr == S_OK)
&#123;
    cout &lt;&lt; &quot;Download XML -----------------&gt; DONE&quot; &lt;&lt; endl;
    get_pic_url();
&#125;
else
&#123;
    std::cout &lt;&lt; &quot;Xml download failed!Please check whether the network connection is normal!&quot; &lt;&lt; std::endl;
    MessageBoxA(NULL, &quot;Xml download failed!Please check whether the network connection is normal!&quot;, &quot;WARNING!&quot;, MB_OK);
&#125;
</code></pre><p>​</p><p>​ Next, the program should know where <code>&lt;image&gt;&lt;url&gt;&lt;/url&gt;&lt;/image&gt;</code> is and what’s in this label. I use <code>tinyxml</code> to make it (<a target="_blank" rel="noopener" href="https://www.google.com/search?client=firefox-b-d&q=tinyxml+parse+xml">more about tinyxml</a>).</p><pre><code class="c">TiXmlDocument doc;
const char* xmlFile = &quot;C:\\Program Files\\The0d0re C00per\\Bing Backgrouds\\XML\\INDEX.xml&quot;;
if (doc.LoadFile(xmlFile))
&#123;
    cout &lt;&lt; &quot;Load file -----------------&gt; DONE&quot; &lt;&lt; endl;
&#125;
else 
&#123;
    cout &lt;&lt; &quot;Can not parse xml!!&quot; &lt;&lt; endl;
    MessageBoxA(NULL, &quot;Can not parse xml!! Please restart the program and try again!!&quot;, &quot;WARNING!&quot;, MB_OK);
&#125;

TiXmlElement* images = doc.RootElement();
TiXmlElement* image = images-&gt;FirstChildElement(&quot;image&quot;);

string WebPicturedomain = &quot;http://www.bing.com&quot;;
string WebPictureUrl = &quot;&quot;;

if (image != NULL)
    WebPictureUrl = image-&gt;FirstChildElement(&quot;url&quot;)-&gt;GetText();

string WebPictureFullpath = WebPicturedomain + WebPictureUrl;
cout &lt;&lt; &quot;Today Wallpaper Url Successful analysis!&quot; &lt;&lt; std::endl;
cout &lt;&lt; &quot;The address is:&quot; &lt;&lt; std::endl;
cout &lt;&lt; WebPictureFullpath &lt;&lt; std::endl;</code></pre><p>​</p><p>​ <code>URLDownloadToFile()</code> again to download the wallpaper…</p><pre><code class="c">string pic_url = WebPictureFullpath;
size_t len0 = pic_url.length();
int nmlen0 = MultiByteToWideChar(CP_ACP, 0, pic_url.c_str(), len0 + 1, NULL, 0);
wchar_t* buffer0 = new wchar_t[nmlen0];
MultiByteToWideChar(CP_ACP, 0, pic_url.c_str(), len0 + 1, buffer0, nmlen0);
HRESULT hr0 = URLDownloadToFile(NULL, buffer0, _T(&quot;C:\\Program Files\\The0d0re C00per\\Bing Backgrouds\\PIC\\Today Wallpaper.png&quot;), 0, NULL);
if (hr0 == S_OK)
&#123;
    cout &lt;&lt; &quot;Wallpaper Successfully Download!!!&quot; &lt;&lt; std::endl;
&#125;
else
&#123;
    std::cout &lt;&lt; &quot;Wallpaper download failed!Please check whether the network connection is normal!&quot; &lt;&lt; std::endl;
    MessageBoxA(NULL, &quot;Wallpaper download failed!Please check whether the network connection is normal!&quot;, &quot;WARNING!&quot;, MB_OK);
&#125;</code></pre><p><strong><em>Finally, it’s time to set wallpaper as the background!!!</em></strong> I wrote a function:</p><pre><code class="c">int ApplyWallpaper(const char* szFileDir, int displayStyle)
&#123;
    WCHAR wsz[MAX_PATH];
    MultiByteToWideChar(
        CP_ACP,
        0,
        szFileDir,
        -1,
        wsz,
        MAX_PATH
    );
    CoInitialize(NULL);
    std::wstring x = wsz;

    DWORD dwStyle = displayStyle;
    HRESULT hr;
    IActiveDesktop* pIAD;
    hr = CoCreateInstance(CLSID_ActiveDesktop, NULL, CLSCTX_INPROC_SERVER,
        IID_IActiveDesktop, (void**)&amp;pIAD);
    if (!SUCCEEDED(hr))
    &#123;
        int errNum = GetLastError();
        return errNum;
    &#125;
    hr = pIAD-&gt;SetWallpaper(x.c_str(), 0);
    if (!SUCCEEDED(hr))
    &#123;
        int errNum = GetLastError();
        return errNum;
    &#125;

    WALLPAPEROPT wpo;
    wpo.dwSize = sizeof(wpo);
    wpo.dwStyle = dwStyle;
    hr = pIAD-&gt;SetWallpaperOptions(&amp;wpo, 0);
    if (!SUCCEEDED(hr))
    &#123;
        int errNum = GetLastError();
        return errNum;
    &#125;

    hr = pIAD-&gt;ApplyChanges(AD_APPLY_ALL);

    if (!SUCCEEDED(hr))
    &#123;
        int errNum = GetLastError();
        return errNum;
    &#125;

    pIAD-&gt;Release();

    CoUninitialize();

    return TRUE;
&#125;
/*
if (ApplyWallpaper(&quot;C:\\Program Files\\The0d0re C00per\\Bing Backgrouds\\PIC\\Today Wallpaper.png&quot;, 0))
&#123;
    std::cout &lt;&lt; &quot;Wallpaper Set!!&quot; &lt;&lt; std::endl;
    MessageBoxA(NULL, &quot;Wallpaper Set!!&quot;, &quot;Bing Backgrounds Getter&quot;, MB_OK);
&#125;
else
&#123;
    std::cout &lt;&lt; &quot;Failed to Set Wallpaper!!&quot; &lt;&lt; std::endl;
    MessageBoxA(NULL, &quot;Failed to Set Wallpaper!!&quot;, &quot;WARNING!&quot;, MB_OK);
&#125;
*/</code></pre><hr><h2><span id="source-code">Source code</span></h2><ul><li>You can find the source code or installer on my <a target="_blank" rel="noopener" href="https://www.github.com/theodorecooper/">Github</a>.</li><li><u>— <del>Star &amp; Fork me</del> —</u></li><li>Give me advice: <a href="mailto:&#99;&#99;&#x6f;&#111;&#112;&#x65;&#x72;&#x72;&#x32;&#48;&#x30;&#53;&#x40;&#103;&#109;&#97;&#x69;&#x6c;&#x2e;&#99;&#111;&#109;">&#99;&#99;&#x6f;&#111;&#112;&#x65;&#x72;&#x72;&#x32;&#48;&#x30;&#53;&#x40;&#103;&#109;&#97;&#x69;&#x6c;&#x2e;&#99;&#111;&#109;</a></li><li>Donate: : )</li></ul><hr><h2><span id="linux">Linux…</span></h2><h3><span id="coming-soon">—————<em>Coming soon…</em></span></h3><p>—————<br><b>Author</b>：Theodore Cooper<br><b>Address</b>： <a href="https://theodorecooper.github.io/2020/bing-backgrounds/">https://theodorecooper.github.io/2020/bing-backgrounds/</a><br><b>Copyright</b>：Copyright © 2020 Theodore Cooper. All rights reserved.<br>—————<br></p></div><div id="disqus_thread"></div><script>var disqus_config=function(){this.page.url=PAGE_URL,this.page.identifier=PAGE_IDENTIFIER};!function(){var e=document,t=e.createElement("script");t.src="https://ccooperr.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)}()</script><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script src="/js/crash_cheat.js"></script><div class="footer" id="footer"><p>Copyright © 2020 <a class="flink" rel="external nofollow noopener" target="_blank" href="https://hexo.io">Hexo</a>-<a class="flink" rel="external nofollow noopener" target="_blank" href="https://github.com/theodorecooper">Theodore Cooper</a>. All rights reserved. <label class="el-switch el-switch-green el-switch-sm" style="vertical-align:sub"><input type="checkbox" name="switch" id="update_style"> <span class="el-switch-style"></span></label></p></div><script src="/libs/jquery.min.js"></script><script src="/libs/highlight/highlight.pack.js"></script><script src="/js/js.js"></script><style>.v *{color:#698fca}.v .vlist .vcard .vhead .vsys{color:#0c243d}.v .vlist .vcard .vh .vmeta .vat{color:#638fd5}.v .vlist .vcard .vhead .vnick{color:#6ba1ff}.v a{color:#8696b1}.v .vlist .vcard .vhead .vnick:hover{color:#669bfc}</style><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,debug:!1,model:{scale:1,hHeadPos:.5,vHeadPos:.618,jsonPath:"/live2dw/assets/tororo.model.json"},display:{superSample:2,width:200,height:400,position:"left",hOffset:0,vOffset:-50},mobile:{show:!1,scale:.5},react:{opacityDefault:.7,opacityOnHover:.2},log:!1})</script></body></html>