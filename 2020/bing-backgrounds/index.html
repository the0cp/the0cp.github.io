<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="google-site-verification" content="BTGobNZt1lO93pNn2A8IVOLeIxK5oTJD2uo9iz1N7kA" />
	<meta name="msvalidate.01" content="F7959A0570D0607B4121B537616DDEAB" />
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>
        Windows, C++ | Bing Backgrounds Getter
    </title>
    
<link rel="stylesheet" href="/libs/highlight/styles/monokai-sublime.css">

    
<link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">

    
<link rel="stylesheet" href="/css/style.css">

	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-DZQ9LW0MKP"></script>
	<script>
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());

	gtag('config', 'G-DZQ9LW0MKP');
	</script>
	
<meta name="generator" content="Hexo 5.2.0"></head>

<body id="bodyx">
    <div class="hd posts">
    <a href="/index.html"><i class="fa fa-reply replay-btn" aria-hidden="true"></i></a>
    <div class="post-title">
        <p>
            Windows, C++ | Bing Backgrounds Getter
        </p>
        <hr>
    </div>
    <div class="post-content">
        <h2 id="Wallpapers-Bing…"><a href="#Wallpapers-Bing…" class="headerlink" title="Wallpapers, Bing…"></a>Wallpapers, Bing…</h2><p>​    Have you ever tried to download wallpapers from <a target="_blank" rel="noopener" href="http://www.bing.com/">www.bing.com</a>? Have you ever dreamed of a fantastic background but feel bored with download wallpapers by hands! It’s a program written by C++, it will automatically download and set wallpaper for you!</p>
<img src="BBG.jpg" alt="My program" style="zoom:25%;" />

<h2 id="How-does-it-works"><a href="#How-does-it-works" class="headerlink" title="How does it works"></a>How does it works</h2><p>​    It will download a XML file contains the API of <a target="_blank" rel="noopener" href="http://www.bing.com/">www.bing.com</a>, and then, I use <a target="_blank" rel="noopener" href="http://www.grinninglizard.com/tinyxml/"><em>tinyxml</em></a> to parse the file to obtain the full URL-path of the daily wallpaper. Finally, the wallpaper will be download and set as the background.</p>
<h2 id="Details"><a href="#Details" class="headerlink" title="Details"></a>Details</h2><p>Platform: </p>
<ul>
<li>Windows 7</li>
<li>Visual Studio 2019(Preview)</li>
<li>Old damn computer &amp; sh*t mouse &amp; dusty keyboard</li>
</ul>
<hr>
<p>​    What’s the local of the wallpaper? After Googling, I get this: <strong><em>“<a target="_blank" rel="noopener" href="https://www.bing.com/HPImageArchive.aspx?format=xml&amp;idx=0&amp;n=1&amp;mkt=en-US&quot;">https://www.bing.com/HPImageArchive.aspx?format=xml&amp;idx=0&amp;n=1&amp;mkt=en-US&quot;</a></em></strong>. That’s important, the full URL is contained in this file. Take a look at the label <code>&lt;image&gt;&lt;url&gt;&lt;/url&gt;&lt;/image&gt;</code>, it’s the part of the full path, just cat <code>&quot;www.bing.com&quot;</code> with it, you will obtain the full path.</p>
<p>​    So, we should download the XML and try to parse it. We require <code>URLDownloadToFile()</code> to download remote files:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> xml_url = <span class="string">&quot;https://cn.bing.com/HPImageArchive.aspx?format=xml&amp;idx=0&amp;n=1&quot;</span>;</span><br><span class="line"><span class="keyword">size_t</span> len = xml_url.length();</span><br><span class="line"><span class="keyword">int</span> nmlen = MultiByteToWideChar(CP_ACP, <span class="number">0</span>, xml_url.c_str(), len + <span class="number">1</span>, <span class="literal">NULL</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">wchar_t</span>* buffer = <span class="keyword">new</span> <span class="keyword">wchar_t</span>[nmlen];</span><br><span class="line">MultiByteToWideChar(CP_ACP, <span class="number">0</span>, xml_url.c_str(), len + <span class="number">1</span>, buffer, nmlen);</span><br><span class="line">HRESULT hr = URLDownloadToFile(<span class="literal">NULL</span>, buffer, _T(<span class="string">&quot;C:\\Program Files\\The0d0re C00per\\Bing Backgrouds\\XML\\INDEX.xml&quot;</span>), <span class="number">0</span>, <span class="literal">NULL</span>);</span><br><span class="line"><span class="keyword">if</span> (hr == S_OK)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Download XML -----------------&gt; DONE&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    get_pic_url();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Xml download failed!Please check whether the network connection is normal!&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    MessageBoxA(<span class="literal">NULL</span>, <span class="string">&quot;Xml download failed!Please check whether the network connection is normal!&quot;</span>, <span class="string">&quot;WARNING!&quot;</span>, MB_OK);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>​    </p>
<p>​    Next, the program should know where <code>&lt;image&gt;&lt;url&gt;&lt;/url&gt;&lt;/image&gt;</code> is and what’s in this label. I use <code>tinyxml</code> to make it (<a target="_blank" rel="noopener" href="https://www.google.com/search?client=firefox-b-d&q=tinyxml+parse+xml">more about tinyxml</a>).</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">TiXmlDocument doc;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span>* xmlFile = <span class="string">&quot;C:\\Program Files\\The0d0re C00per\\Bing Backgrouds\\XML\\INDEX.xml&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (doc.LoadFile(xmlFile))</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Load file -----------------&gt; DONE&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Can not parse xml!!&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    MessageBoxA(<span class="literal">NULL</span>, <span class="string">&quot;Can not parse xml!! Please restart the program and try again!!&quot;</span>, <span class="string">&quot;WARNING!&quot;</span>, MB_OK);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">TiXmlElement* images = doc.RootElement();</span><br><span class="line">TiXmlElement* image = images-&gt;FirstChildElement(<span class="string">&quot;image&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span> WebPicturedomain = <span class="string">&quot;http://www.bing.com&quot;</span>;</span><br><span class="line"><span class="built_in">string</span> WebPictureUrl = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (image != <span class="literal">NULL</span>)</span><br><span class="line">    WebPictureUrl = image-&gt;FirstChildElement(<span class="string">&quot;url&quot;</span>)-&gt;GetText();</span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span> WebPictureFullpath = WebPicturedomain + WebPictureUrl;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Today Wallpaper Url Successful analysis!&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;The address is:&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; WebPictureFullpath &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br></pre></td></tr></table></figure>

<p>​    </p>
<p>​    <code>URLDownloadToFile()</code> again to download the wallpaper…</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> pic_url = WebPictureFullpath;</span><br><span class="line"><span class="keyword">size_t</span> len0 = pic_url.length();</span><br><span class="line"><span class="keyword">int</span> nmlen0 = MultiByteToWideChar(CP_ACP, <span class="number">0</span>, pic_url.c_str(), len0 + <span class="number">1</span>, <span class="literal">NULL</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">wchar_t</span>* buffer0 = <span class="keyword">new</span> <span class="keyword">wchar_t</span>[nmlen0];</span><br><span class="line">MultiByteToWideChar(CP_ACP, <span class="number">0</span>, pic_url.c_str(), len0 + <span class="number">1</span>, buffer0, nmlen0);</span><br><span class="line">HRESULT hr0 = URLDownloadToFile(<span class="literal">NULL</span>, buffer0, _T(<span class="string">&quot;C:\\Program Files\\The0d0re C00per\\Bing Backgrouds\\PIC\\Today Wallpaper.png&quot;</span>), <span class="number">0</span>, <span class="literal">NULL</span>);</span><br><span class="line"><span class="keyword">if</span> (hr0 == S_OK)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Wallpaper Successfully Download!!!&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Wallpaper download failed!Please check whether the network connection is normal!&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    MessageBoxA(<span class="literal">NULL</span>, <span class="string">&quot;Wallpaper download failed!Please check whether the network connection is normal!&quot;</span>, <span class="string">&quot;WARNING!&quot;</span>, MB_OK);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong><em>Finally, it’s time to set wallpaper as the background!!!</em></strong> I wrote a function:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">ApplyWallpaper</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* szFileDir, <span class="keyword">int</span> displayStyle)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    WCHAR wsz[MAX_PATH];</span><br><span class="line">    MultiByteToWideChar(</span><br><span class="line">        CP_ACP,</span><br><span class="line">        <span class="number">0</span>,</span><br><span class="line">        szFileDir,</span><br><span class="line">        <span class="number">-1</span>,</span><br><span class="line">        wsz,</span><br><span class="line">        MAX_PATH</span><br><span class="line">    );</span><br><span class="line">    CoInitialize(<span class="literal">NULL</span>);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">wstring</span> x = wsz;</span><br><span class="line"></span><br><span class="line">    DWORD dwStyle = displayStyle;</span><br><span class="line">    HRESULT hr;</span><br><span class="line">    IActiveDesktop* pIAD;</span><br><span class="line">    hr = CoCreateInstance(CLSID_ActiveDesktop, <span class="literal">NULL</span>, CLSCTX_INPROC_SERVER,</span><br><span class="line">        IID_IActiveDesktop, (<span class="keyword">void</span>**)&amp;pIAD);</span><br><span class="line">    <span class="keyword">if</span> (!SUCCEEDED(hr))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> errNum = GetLastError();</span><br><span class="line">        <span class="keyword">return</span> errNum;</span><br><span class="line">    &#125;</span><br><span class="line">    hr = pIAD-&gt;SetWallpaper(x.c_str(), <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (!SUCCEEDED(hr))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> errNum = GetLastError();</span><br><span class="line">        <span class="keyword">return</span> errNum;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    WALLPAPEROPT wpo;</span><br><span class="line">    wpo.dwSize = <span class="keyword">sizeof</span>(wpo);</span><br><span class="line">    wpo.dwStyle = dwStyle;</span><br><span class="line">    hr = pIAD-&gt;SetWallpaperOptions(&amp;wpo, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (!SUCCEEDED(hr))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> errNum = GetLastError();</span><br><span class="line">        <span class="keyword">return</span> errNum;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    hr = pIAD-&gt;ApplyChanges(AD_APPLY_ALL);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!SUCCEEDED(hr))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> errNum = GetLastError();</span><br><span class="line">        <span class="keyword">return</span> errNum;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    pIAD-&gt;Release();</span><br><span class="line"></span><br><span class="line">    CoUninitialize();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">if (ApplyWallpaper(&quot;C:\\Program Files\\The0d0re C00per\\Bing Backgrouds\\PIC\\Today Wallpaper.png&quot;, 0))</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">	std::cout &lt;&lt; &quot;Wallpaper Set!!&quot; &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">    MessageBoxA(NULL, &quot;Wallpaper Set!!&quot;, &quot;Bing Backgrounds Getter&quot;, MB_OK);</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">else</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">	std::cout &lt;&lt; &quot;Failed to Set Wallpaper!!&quot; &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">    MessageBoxA(NULL, &quot;Failed to Set Wallpaper!!&quot;, &quot;WARNING!&quot;, MB_OK);</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="Source-code"><a href="#Source-code" class="headerlink" title="Source code"></a>Source code</h2><ul>
<li>You can find the source code or installer on my <a target="_blank" rel="noopener" href="https://www.github.com/theodorecooper/">Github</a>.</li>
<li><u>— <del>Star &amp; Fork me</del> —</u></li>
<li>Give me advice: <a href="mailto:&#99;&#x63;&#x6f;&#x6f;&#x70;&#101;&#114;&#x72;&#50;&#48;&#x30;&#x35;&#x40;&#x67;&#109;&#x61;&#x69;&#x6c;&#46;&#99;&#x6f;&#x6d;">&#99;&#x63;&#x6f;&#x6f;&#x70;&#101;&#114;&#x72;&#50;&#48;&#x30;&#x35;&#x40;&#x67;&#109;&#x61;&#x69;&#x6c;&#46;&#99;&#x6f;&#x6d;</a></li>
<li>Donate:    : )</li>
</ul>
<hr>
<h2 id="Linux…"><a href="#Linux…" class="headerlink" title="Linux…"></a>Linux…</h2><h3 id="—————Coming-soon…"><a href="#—————Coming-soon…" class="headerlink" title="—————Coming soon…"></a>—————<em>Coming soon…</em></h3>
			

    </div>
	<div id="disqus_thread" style="true"></div>

	
<script>


var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://ccooperr.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                            
</div>

<script type="text/javascript" src="/js/crash_cheat.js"></script>


    <div class="footer" id="footer">
    <p>Copyright © 2020 <a class="flink" target="_blank" rel="noopener" href="https://hexo.io">Hexo</a>-<a class="flink" target="_blank" rel="noopener" href="https://github.com/theodorecooper">Theodore Cooper</a>.
        <label class="el-switch el-switch-green el-switch-sm" style="vertical-align: sub;">
            <input type="checkbox" name="switch" id="update_style">
            <span class="el-switch-style"></span>
        </label>
<!--         <script type="text/javascript">
        var cnzz_protocol = (("https:" == document.location.protocol) ? "https://" : "http://");
        document.write(unescape("%3Cspan id='cnzz_stat_icon_1278548644'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "v1.cnzz.com/stat.php%3Fid%3D1278548644%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
        </script> -->
    </p>
</div>

<script src="/libs/jquery.min.js"></script>


<script src="/libs/highlight/highlight.pack.js"></script>



<script src="/js/js.js"></script>

<style type="text/css">
.v * {
    color: #698fca;
}

.v .vlist .vcard .vhead .vsys {
    color: #0c243d;
}

.v .vlist .vcard .vh .vmeta .vat {
    color: #638fd5;
}

.v .vlist .vcard .vhead .vnick {
    color: #6ba1ff;
}

.v a {
    color: #8696b1;
}

.v .vlist .vcard .vhead .vnick:hover {
    color: #669bfc;
}
</style>
</body>

</html>