<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="google-site-verification" content="BTGobNZt1lO93pNn2A8IVOLeIxK5oTJD2uo9iz1N7kA"><meta name="msvalidate.01" content="F7959A0570D0607B4121B537616DDEAB"><meta name="renderer" content="webkit"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>Linux, C | Bing Backgrounds Getter</title><link href="/css/fontisto/fontisto.min.css" rel="stylesheet"><link rel="stylesheet" href="/libs/highlight/styles/monokai-sublime.css"><link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="/css/style.css"><link href="http://fonts.googleapis.com/css?family=Raleway:100,200,300,400" rel="stylesheet"><script src="/dist/lib/modernizr.touch.js"></script><link href="/dist/mfb.css" rel="stylesheet"><script async src="https://www.googletagmanager.com/gtag/js?id=G-DZQ9LW0MKP"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-DZQ9LW0MKP")</script><meta name="generator" content="Hexo 5.2.0"></head><body id="bodyx"><ul id="menu" class="mfb-component--br mfb-zoomin" data-mfb-toggle="click"><li class="mfb-component__wrap"><a class="mfb-component__button--main"><i class="mfb-component__main-icon--resting fi fi-plus-a"></i> <i class="mfb-component__main-icon--active fi fi-close-a"></i></a><ul class="mfb-component__list"><li><a href="https://theodorecooper.github.io/Github" data-mfb-label="Follow me on Github" class="mfb-component__button--child" target="_blank"><i class="mfb-component__child-icon fi fi-github"></i></a></li><li><a href="https://theodorecooper.github.io/Twitter" data-mfb-label="Follow me on Twitter" class="mfb-component__button--child" target="_blank"><i class="mfb-component__child-icon fi fi-twitter"></i></a></li></ul></li></ul><script src="/dist/mfb.js"></script><div class="hd posts"><a href="/index.html"><i class="fa fa-reply replay-btn" aria-hidden="true"></i></a><div class="post-title"><p>Linux, C | Bing Backgrounds Getter</p><hr></div><div class="post-content"><h2 id="Linux-Bing…"><a href="#Linux-Bing…" class="headerlink" title="Linux, Bing…"></a>Linux, Bing…</h2><blockquote><p>​ Have you ever tried to download wallpapers from <a target="_blank" rel="noopener" href="http://www.bing.com/">www.bing.com</a>? Have you ever dreamed of a fantastic background but feel bored with download wallpapers by hands!</p></blockquote><p>​ It’s a program written by C, it will automatically download and set wallpaper for you on Linux!</p><h2 id="How-does-it-works"><a href="#How-does-it-works" class="headerlink" title="How does it works"></a>How does it works</h2><p>​ It will download a XML file contains the API of <a target="_blank" rel="noopener" href="http://www.bing.com/">www.bing.com</a>, and then, I parse the file to obtain the full URL-path of the daily wallpaper. Finally, the wallpaper will be download and set as the background.</p><h2 id="Details"><a href="#Details" class="headerlink" title="Details"></a>Details</h2><p>Development environment:</p><ul><li><p>Linux 5.7.0 amd64 x86_64</p></li><li><p>MATE 1.24.0</p></li><li><p>gcc version 9.3.0 (Debian 9.3.0-15)</p></li><li><p>curl 7.72.0 (x86_64-pc-linux-gnu)</p></li><li><p>libxml2</p></li><li><p>vim</p><hr><p>​ So, how Linux download files with C? There’s no <code>URLDownloadToFile()</code>, but we have a stronger tool – <strong><em>curl</em></strong>. After installing the libcurl package for C, we can use it to download the files.</p><p>Install libcurl:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo apt-get update </span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo apt-get install curl </span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo apt-get install libcurl4-openssl-dev</span></span><br></pre></td></tr></table></figure><p>Download with curl:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">*#include &lt;curl/curl.h&gt;</span></span><br><span class="line"><span class="comment">*remember this!!!</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">curlXml = curl_easy_init();</span><br><span class="line"><span class="keyword">if</span> (curlXml)</span><br><span class="line">&#123;</span><br><span class="line">    fpXml = fopen(xmlName, <span class="string">&quot;wb&quot;</span>);</span><br><span class="line">    curl_easy_setopt(curlXml, CURLOPT_URL, xml_url);</span><br><span class="line">    curl_easy_setopt(curlXml, CURLOPT_WRITEFUNCTION, write_data);</span><br><span class="line">    curl_easy_setopt(curlXml, CURLOPT_WRITEDATA, fpXml);</span><br><span class="line">    curl_easy_setopt (curlXml, CURLOPT_NOPROGRESS, <span class="number">0</span>);  </span><br><span class="line">    resXml = curl_easy_perform(curlXml);</span><br><span class="line">    curl_easy_cleanup(curlXml);</span><br><span class="line">    fclose(fpXml);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>​ After it, another big problem, how to parse the XML? I tried <em><code>tinyxml</code></em>, but such foolish thing even can hardly be installed on my lovely Linux! Then I find another easier way, <strong><em><code>libxml</code></em></strong>. With the help of APT, I easily installed <code>libxml</code>, next I learned how to use it.</p><p>Install libxml:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo apt-get install libxml2</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo apt-get install libxml2-dev</span></span><br></pre></td></tr></table></figure><p>Here’s the example:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">*#include &lt;libxml/tree.h&gt;</span></span><br><span class="line"><span class="comment">*#include &lt;libxml/parser.h&gt;</span></span><br><span class="line"><span class="comment">*remember this!!!</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">xmlDocPtr pdoc = <span class="literal">NULL</span>;</span><br><span class="line">xmlNodePtr proot = <span class="literal">NULL</span>;</span><br><span class="line">xmlNodePtr pcur = <span class="literal">NULL</span>;</span><br><span class="line">  </span><br><span class="line">xmlKeepBlanksDefault(<span class="number">0</span>); <span class="comment">//Blanks may be parse as a node</span></span><br><span class="line">pdoc = xmlReadFile(xmlName, <span class="string">&quot;UTF-8&quot;</span>, XML_PARSE_RECOVER);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (pdoc == <span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">printf</span>(RED<span class="string">&quot;ERROR:cannot open xml!!!\n&quot;</span>);</span><br><span class="line">   	<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">proot = xmlDocGetRootElement(pdoc);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(proot == <span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">printf</span>(RED<span class="string">&quot;ERROR: Xml is empty!!!\n&quot;</span>);</span><br><span class="line">   	<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pcur = proot -&gt; xmlChildrenNode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (pcur != <span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!xmlStrcmp(pcur-&gt;name, BAD_CAST(<span class="string">&quot;image&quot;</span>)))</span><br><span class="line">    &#123;</span><br><span class="line">        xmlNodePtr nptr=pcur-&gt;xmlChildrenNode;</span><br><span class="line">      	<span class="keyword">while</span> (pcur != <span class="literal">NULL</span>)</span><br><span class="line">      	&#123;</span><br><span class="line">            <span class="keyword">if</span> (!xmlStrcmp(nptr-&gt;name, BAD_CAST(<span class="string">&quot;url&quot;</span>)))</span><br><span class="line">            &#123;       </span><br><span class="line">        		urlPart = XML_GET_CONTENT(nptr-&gt;xmlChildrenNode);</span><br><span class="line">        		<span class="built_in">printf</span>(<span class="string">&quot;URL part: %s&quot;</span>, urlPart);</span><br><span class="line">        		<span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        	nptr = nptr -&gt; next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    pcur = pcur -&gt; next;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">xmlFreeDoc(pdoc);</span><br><span class="line">xmlCleanupParser();</span><br><span class="line">xmlMemoryDump();</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;&lt;Parse Done!!!&gt;\n&quot;</span>);</span><br></pre></td></tr></table></figure><p>​ <strong><em><code>curl</code></em></strong> again!!! The wallpaper successfully downloaded!!!</p><hr><h2 id="Finally-how-to-set-wallpapers…"><a href="#Finally-how-to-set-wallpapers…" class="headerlink" title="Finally, how to set wallpapers…"></a>Finally, how to set wallpapers…</h2><p><img src="appearance.png" alt="Set Backgrounds"></p><p>​ I promise, I won’t let you set backgrounds like that, you won’t need to open your control center - Look and Feel - Appearance. We use <strong><em><code>gsettings</code></em></strong>.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gsettings set org.mate.background picture-filename picUri</span><br></pre></td></tr></table></figure><p>​ Gnome 3 is supported too:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gsettings set org.gnome.desktop.background picture-uri picUri</span><br></pre></td></tr></table></figure><h3 id="It-support"><a href="#It-support" class="headerlink" title="It support:"></a>It support:</h3><ul><li>Gnome 3 test on latest Ubuntu (ubuntu-20.04.1-desktop-amd64)</li><li>MATE test on Debian 10</li><li><strong><em>Xfce isn’t supported now</em></strong></li><li>You can just store the wallpaper, if you don’t want to change your backgrounds</li></ul><hr><h2 id="Source-code"><a href="#Source-code" class="headerlink" title="Source code"></a>Source code</h2><ul><li>You can find the source code on my <a target="_blank" rel="noopener" href="https://www.github.com/theodorecooper/">Github</a>.</li><li><u>— <del>Star &amp; Fork me</del> —</u></li><li>Give me advice: <a href="mailto:&#x63;&#99;&#x6f;&#111;&#x70;&#101;&#114;&#x72;&#x32;&#x30;&#x30;&#53;&#64;&#x67;&#109;&#97;&#105;&#x6c;&#x2e;&#x63;&#111;&#109;">&#x63;&#99;&#x6f;&#111;&#x70;&#101;&#114;&#x72;&#x32;&#x30;&#x30;&#53;&#64;&#x67;&#109;&#97;&#105;&#x6c;&#x2e;&#x63;&#111;&#109;</a></li><li>Donate: : )</li></ul><h3 id="Compile-amp-Build-the-code"><a href="#Compile-amp-Build-the-code" class="headerlink" title="Compile &amp; Build the code"></a>Compile &amp; Build the code</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">clone</span> https://github.com/theodorecooper/Linux-Bing-Backgrounds-Getter.git</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> Linux-Bing-Backgrounds-Getter</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> make</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ./bingbg</span></span><br></pre></td></tr></table></figure></li></ul></div><div id="disqus_thread"></div><script>var disqus_config=function(){this.page.url=PAGE_URL,this.page.identifier=PAGE_IDENTIFIER};!function(){var e=document,t=e.createElement("script");t.src="https://ccooperr.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)}()</script><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script src="/js/crash_cheat.js"></script><div class="footer" id="footer"><p>Copyright © 2020 <a class="flink" target="_blank" rel="noopener" href="https://hexo.io">Hexo</a>-<a class="flink" target="_blank" rel="noopener" href="https://github.com/theodorecooper">Theodore Cooper</a>. <label class="el-switch el-switch-green el-switch-sm" style="vertical-align:sub"><input type="checkbox" name="switch" id="update_style"> <span class="el-switch-style"></span></label></p></div><script src="/libs/jquery.min.js"></script><script src="/libs/highlight/highlight.pack.js"></script><script src="/js/js.js"></script><style>.v *{color:#698fca}.v .vlist .vcard .vhead .vsys{color:#0c243d}.v .vlist .vcard .vh .vmeta .vat{color:#638fd5}.v .vlist .vcard .vhead .vnick{color:#6ba1ff}.v a{color:#8696b1}.v .vlist .vcard .vhead .vnick:hover{color:#669bfc}</style><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,debug:!1,model:{scale:1,hHeadPos:.5,vHeadPos:.618,jsonPath:"/live2dw/assets/tororo.model.json"},display:{superSample:2,width:200,height:400,position:"left",hOffset:0,vOffset:-50},mobile:{show:!0,scale:.5},react:{opacityDefault:.7,opacityOnHover:.2},log:!1})</script></body></html>