<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="msvalidate.01" content="F7959A0570D0607B4121B537616DDEAB"><meta name="renderer" content="webkit"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="keywords" content=""><meta name="description" content=""><title>Linux, C | Bing Backgrounds GetterTheodore Cooper's Blog</title><script src="/sweetalert2/dist/sweetalert2.all.min.js"></script><script src="/promise-polyfill/dist/polyfill.js"></script><link rel="stylesheet" href="/sweetalert2/dist/sweetalert2.min.css"><link href="/css/fontisto/fontisto.min.css" rel="stylesheet"><link rel="stylesheet" href="/libs/highlight/styles/androidstudio.css"><link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="/css/style.css"><link href="http://fonts.googleapis.com/css?family=Raleway:100,200,300,400" rel="stylesheet"><script src="/dist/lib/modernizr.touch.js"></script><link href="/dist/mfb.css" rel="stylesheet"><script async src="https://www.googletagmanager.com/gtag/js?id=G-DZQ9LW0MKP"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-DZQ9LW0MKP")</script><script>!function(t,e,n,c,a,r){t[n]=t[n]||function(){(t[n].q=t[n].q||[]).push(arguments)},(a=e.createElement(c)).async=1,a.src="https://www.clarity.ms/tag/4dyudg5g3l",(r=e.getElementsByTagName(c)[0]).parentNode.insertBefore(a,r)}(window,document,"clarity","script")</script><meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="Theodore Cooper's Blog" type="application/atom+xml"></head><body id="bodyx"><ul id="menu" class="mfb-component--br mfb-slidein-spring" data-mfb-toggle="click"><li class="mfb-component__wrap"><a class="mfb-component__button--main"><i class="mfb-component__main-icon--resting fi fi-plus-a"></i> <i class="mfb-component__main-icon--active fi fi-close-a"></i></a><ul class="mfb-component__list"><li><a href="https://theodorecooper.github.io/atom.xml" data-mfb-label="RSS" class="mfb-component__button--child" target="_blank"><i class="mfb-component__child-icon fi fi-rss"></i></a></li><li><a href="https://theodorecooper.github.io/tags" data-mfb-label="View the tags" class="mfb-component__button--child" target="_blank"><i class="mfb-component__child-icon fi fi-hashtag"></i></a></li><li><a href="https://theodorecooper.github.io/Github" data-mfb-label="Follow me on Github" class="mfb-component__button--child" target="_blank"><i class="mfb-component__child-icon fi fi-github"></i></a></li><li><a href="https://theodorecooper.github.io/Twitter" data-mfb-label="Follow me on Twitter" class="mfb-component__button--child" target="_blank"><i class="mfb-component__child-icon fi fi-twitter"></i></a></li><li><a href="javascrip:void(0)" onclick="donate()" data-mfb-label="Buy me a cup of coffee!" class="mfb-component__button--child" target="_self"><i class="mfb-component__child-icon fi fi-bitcoin"></i></a></li></ul></li></ul><script src="/dist/mfb.js"></script><script>var donate=function(){Swal.fire({title:"Donate",html:"Buy me a cup of coffee!!! <br><br>zpub6maNAHkLN2gfztxLDnKVjJASMk1Ra5DgdF2yGSTov7VXUn3Eijusyye89aKSwZWxrRas4QJnVtwXKEzdpKhTMSgiXF9RuK6AMm6w3V4jnMr",imageUrl:"/btcqrcode.png",imageWidth:205,imageHeight:205,imageAlt:"Bitcoin Donate",animation:!0,footer:"<b>Thank you for donation!!!</b>"})}</script><div class="hd posts"><a href="/index.html"><i class="fa fa-reply replay-btn" aria-hidden="true"></i></a><div class="post-title"><p>Linux, C | Bing Backgrounds Getter</p><hr></div><div class="post-content"><h1><span id="linux-c-bing-backgrounds-getter"><center>Linux, C | Bing Backgrounds Getter</center></span></h1><h2><span id="linux-bing">Linux, Bing…</span></h2><blockquote><p>​ Have you ever tried to download wallpapers from <a target="_blank" rel="noopener" href="http://www.bing.com/">www.bing.com</a>? Have you ever dreamed of a fantastic background but feel bored with download wallpapers by hands!</p></blockquote><p>​ It’s a program written by C, it will automatically download and set wallpaper for you on Linux!</p><h2><span id="how-does-it-works">How does it works</span></h2><p>​ It will download a XML file contains the API of <a target="_blank" rel="noopener" href="http://www.bing.com/">www.bing.com</a>, and then, I parse the file to obtain the full URL-path of the daily wallpaper. Finally, the wallpaper will be download and set as the background.</p><h2><span id="details">Details</span></h2><p>Development environment:</p><ul><li><p>Linux 5.7.0 amd64 x86_64</p></li><li><p>MATE 1.24.0</p></li><li><p>gcc version 9.3.0 (Debian 9.3.0-15)</p></li><li><p>curl 7.72.0 (x86_64-pc-linux-gnu)</p></li><li><p>libxml2</p></li><li><p>vim</p><hr><p>​ So, how Linux download files with C? There’s no <code>URLDownloadToFile()</code>, but we have a stronger tool – <strong><em>curl</em></strong>. After installing the libcurl package for C, we can use it to download the files.</p><p>Install libcurl:</p><pre><code class="shell">$ sudo apt-get update 
$ sudo apt-get install curl 
$ sudo apt-get install libcurl4-openssl-dev</code></pre><p>Download with curl:</p><pre><code class="c">/*
*#include &lt;curl/curl.h&gt;
*remember this!!!
*/

curlXml = curl_easy_init();
if (curlXml)
&#123;
    fpXml = fopen(xmlName, &quot;wb&quot;);
    curl_easy_setopt(curlXml, CURLOPT_URL, xml_url);
    curl_easy_setopt(curlXml, CURLOPT_WRITEFUNCTION, write_data);
    curl_easy_setopt(curlXml, CURLOPT_WRITEDATA, fpXml);
    curl_easy_setopt (curlXml, CURLOPT_NOPROGRESS, 0);  
    resXml = curl_easy_perform(curlXml);
    curl_easy_cleanup(curlXml);
    fclose(fpXml);
&#125;</code></pre><p>​ After it, another big problem, how to parse the XML? I tried <em><code>tinyxml</code></em>, but such foolish thing even can hardly be installed on my lovely Linux! Then I find another easier way, <strong><em><code>libxml</code></em></strong>. With the help of APT, I easily installed <code>libxml</code>, next I learned how to use it.</p><p>Install libxml:</p><pre><code class="shell">$ sudo apt-get install libxml2
$ sudo apt-get install libxml2-dev</code></pre><p>Here’s the example:</p><pre><code class="c">/*
*#include &lt;libxml/tree.h&gt;
*#include &lt;libxml/parser.h&gt;
*remember this!!!
*/

xmlDocPtr pdoc = NULL;
xmlNodePtr proot = NULL;
xmlNodePtr pcur = NULL;

xmlKeepBlanksDefault(0); //Blanks may be parse as a node
pdoc = xmlReadFile(xmlName, &quot;UTF-8&quot;, XML_PARSE_RECOVER);

if (pdoc == NULL)
&#123;
    printf(RED&quot;ERROR:cannot open xml!!!\n&quot;);
       exit(1);
&#125;

proot = xmlDocGetRootElement(pdoc);

if(proot == NULL)
&#123;
    printf(RED&quot;ERROR: Xml is empty!!!\n&quot;);
       exit(1);
&#125;

pcur = proot -&gt; xmlChildrenNode;

while (pcur != NULL)
&#123;
    if (!xmlStrcmp(pcur-&gt;name, BAD_CAST(&quot;image&quot;)))
    &#123;
        xmlNodePtr nptr=pcur-&gt;xmlChildrenNode;
          while (pcur != NULL)
          &#123;
            if (!xmlStrcmp(nptr-&gt;name, BAD_CAST(&quot;url&quot;)))
            &#123;       
                urlPart = XML_GET_CONTENT(nptr-&gt;xmlChildrenNode);
                printf(&quot;URL part: %s&quot;, urlPart);
                break;
            &#125;
            nptr = nptr -&gt; next;
        &#125;
    &#125;
    pcur = pcur -&gt; next;
&#125;

xmlFreeDoc(pdoc);
xmlCleanupParser();
xmlMemoryDump();
printf(&quot;&lt;Parse Done!!!&gt;\n&quot;);</code></pre><p>​ <strong><em><code>curl</code></em></strong> again!!! The wallpaper successfully downloaded!!!</p><hr><h2><span id="finally-how-to-set-wallpapers">Finally, how to set wallpapers…</span></h2><p><img src="appearance.png" alt="Set Backgrounds"></p><p>​ I promise, I won’t let you set backgrounds like that, you won’t need to open your control center - Look and Feel - Appearance. We use <strong><em><code>gsettings</code></em></strong>.</p><pre><code class="shell">gsettings set org.mate.background picture-filename picUri</code></pre><p>​ Gnome 3 is supported too:</p><pre><code class="shell">gsettings set org.gnome.desktop.background picture-uri picUri</code></pre><h3><span id="it-support">It support:</span></h3><ul><li>Gnome 3 test on latest Ubuntu (ubuntu-20.04.1-desktop-amd64)</li><li>MATE test on Debian 10</li><li><strong><em>Xfce isn’t supported now</em></strong></li><li>You can just store the wallpaper, if you don’t want to change your backgrounds</li></ul><hr><h2><span id="source-code">Source code</span></h2><ul><li>You can find the source code on my <a target="_blank" rel="noopener" href="https://www.github.com/theodorecooper/">Github</a>.</li><li><u>— <del>Star &amp; Fork me</del> —</u></li><li>Give me advice: <a href="mailto:&#99;&#99;&#111;&#111;&#x70;&#101;&#x72;&#x72;&#50;&#x30;&#x30;&#x35;&#x40;&#x67;&#109;&#x61;&#105;&#x6c;&#x2e;&#99;&#111;&#109;">&#99;&#99;&#111;&#111;&#x70;&#101;&#x72;&#x72;&#50;&#x30;&#x30;&#x35;&#x40;&#x67;&#109;&#x61;&#105;&#x6c;&#x2e;&#99;&#111;&#109;</a></li><li>Donate: : )</li></ul><h3><span id="compile-amp-build-the-code">Compile &amp; Build the code</span></h3><pre><code class="shell">$ git clone https://github.com/theodorecooper/Linux-Bing-Backgrounds-Getter.git
$ cd Linux-Bing-Backgrounds-Getter
$ make
$ ./bingbg</code></pre></li></ul><p>—————<br><b>Author</b>：Theodore Cooper<br><b>Address</b>： <a href="https://theodorecooper.github.io/2020/linux-bingbg/">https://theodorecooper.github.io/2020/linux-bingbg/</a><br><b>Copyright</b>：Copyright © 2020 Theodore Cooper. All rights reserved.<br>—————<br></p></div><div id="disqus_thread"></div><script>var disqus_config=function(){this.page.url=PAGE_URL,this.page.identifier=PAGE_IDENTIFIER};!function(){var e=document,t=e.createElement("script");t.src="https://ccooperr.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)}()</script><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script src="/js/crash_cheat.js"></script><div class="footer" id="footer"><p>Copyright © 2020 <a class="flink" rel="external nofollow noopener" target="_blank" href="https://hexo.io">Hexo</a>-<a class="flink" rel="external nofollow noopener" target="_blank" href="https://github.com/theodorecooper">Theodore Cooper</a>. All rights reserved. <label class="el-switch el-switch-green el-switch-sm" style="vertical-align:sub"><input type="checkbox" name="switch" id="update_style"> <span class="el-switch-style"></span></label></p></div><script src="/libs/jquery.min.js"></script><script src="/libs/highlight/highlight.pack.js"></script><script src="/js/js.js"></script><style>.v *{color:#698fca}.v .vlist .vcard .vhead .vsys{color:#0c243d}.v .vlist .vcard .vh .vmeta .vat{color:#638fd5}.v .vlist .vcard .vhead .vnick{color:#6ba1ff}.v a{color:#8696b1}.v .vlist .vcard .vhead .vnick:hover{color:#669bfc}</style><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,debug:!1,model:{scale:1,hHeadPos:.5,vHeadPos:.618,jsonPath:"/live2dw/assets/tororo.model.json"},display:{superSample:2,width:200,height:400,position:"left",hOffset:0,vOffset:-50},mobile:{show:!1,scale:.5},react:{opacityDefault:.7,opacityOnHover:.2},log:!1})</script></body></html>