import*as dom from"../utils/dom/index.js";import{DismissReason}from"../utils/DismissReason.js";import{callIfFunction}from"../utils/utils.js";import{clickConfirm}from"../staticMethods/dom.js";import privateProps from"../privateProps.js";export const addKeydownHandler=(e,t,n,o)=>{t.keydownTarget&&t.keydownHandlerAdded&&(t.keydownTarget.removeEventListener("keydown",t.keydownHandler,{capture:t.keydownListenerCapture}),t.keydownHandlerAdded=!1),n.toast||(t.keydownHandler=t=>keydownHandler(e,t,o),t.keydownTarget=n.keydownListenerCapture?window:dom.getPopup(),t.keydownListenerCapture=n.keydownListenerCapture,t.keydownTarget.addEventListener("keydown",t.keydownHandler,{capture:t.keydownListenerCapture}),t.keydownHandlerAdded=!0)};export const setFocus=(e,t,n)=>{const o=dom.getFocusableElements();if(o.length)return(t+=n)===o.length?t=0:-1===t&&(t=o.length-1),o[t].focus();dom.getPopup().focus()};const arrowKeysNextButton=["ArrowRight","ArrowDown","Right","Down"],arrowKeysPreviousButton=["ArrowLeft","ArrowUp","Left","Up"],escKeys=["Escape","Esc"],keydownHandler=(e,t,n)=>{const o=privateProps.innerParams.get(e);o.stopKeydownPropagation&&t.stopPropagation(),"Enter"===t.key?handleEnter(e,t,o):"Tab"===t.key?handleTab(t,o):[...arrowKeysNextButton,...arrowKeysPreviousButton].includes(t.key)?handleArrows(t.key):escKeys.includes(t.key)&&handleEsc(t,o,n)},handleEnter=(e,t,n)=>{if(!t.isComposing&&t.target&&e.getInput()&&t.target.outerHTML===e.getInput().outerHTML){if(["textarea","file"].includes(n.input))return;clickConfirm(),t.preventDefault()}},handleTab=(e,t)=>{const n=e.target,o=dom.getFocusableElements();let r=-1;for(let e=0;e<o.length;e++)if(n===o[e]){r=e;break}e.shiftKey?setFocus(0,r,-1):setFocus(0,r,1),e.stopPropagation(),e.preventDefault()},handleArrows=e=>{if(![dom.getConfirmButton(),dom.getDenyButton(),dom.getCancelButton()].includes(document.activeElement))return;const t=arrowKeysNextButton.includes(e)?"nextElementSibling":"previousElementSibling",n=document.activeElement[t];n&&n.focus()},handleEsc=(e,t,n)=>{callIfFunction(t.allowEscapeKey)&&(e.preventDefault(),n(DismissReason.esc))};